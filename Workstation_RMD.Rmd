---
title: "Workstation_Statistics"
author: "Torin White"
date: "July 30, 2020"
output: html_document
---

#pull data from responses automatically published to the following googple sheet
```{r library_load}
library(tidyverse)
library(googlesheets4)
library(stringr)
library(rebus)
library(RColorBrewer)
```

#pull data from spreadsheet @ https://docs.google.com/spreadsheets/d/1hI-Vc059lvrxGeTBdNxVkXel2Hmyz-Gub5FD0qdJMJU/edit?usp=sharing
#note: spreadsheet is automatically updated with new responses
# only need to run this code chunk if there are new entries to google form
```{r Workstation_data}
data <- read_sheet("https://docs.google.com/spreadsheets/d/1hI-Vc059lvrxGeTBdNxVkXel2Hmyz-Gub5FD0qdJMJU/edit?usp=sharing")
getwd()
setwd("data")
write.csv(data, "Workstation_data.csv")
```

## Data Cleaning ##
```{r}
# make new df
getwd()
setwd("data")
Workstation_data <- read.csv("Workstation_data.csv")
```
```{r to lowercase, echo=FALSE}
#make Department and Status columns lowercase
Workstation_data$Department <- tolower(Workstation_data$Department)
Workstation_data$Status <- tolower(Workstation_data$Status)
```
```{r trim whitespace, echo=FALSE}

##use str_trim() instead
#trim whitespace
Workstation_data$Department <- trimws(Workstation_data$Department, which = c("both"))
Workstation_data$Status <- trimws(Workstation_data$Status, which = c("both"))
```
```{r department cleaning, echo= FALSE}
##Department Normalization

# Normalize anthropology
anth <- Workstation_data$Department %in% c("anth", "anthro")
Workstation_data$Department[anth] <- "anthropology"

#Normalize biology/eemb/mcdb
bioeembmcdb <- Workstation_data$Department %in% c("bio", "biology", "eemb", "mcdb" )
Workstation_data$Department[bioeembmcdb] <- "biology/eemb/mcdb"

#Normalize bren/environmental studies
brenenviron <- Workstation_data$Department %in% c("environmental studies", "bren / environmental studies", "mesm", "environmental science" )
Workstation_data$Department[brenenviron] <- "bren/environmental studies"

#Normalize Communication
comm <- Workstation_data$Department %in% c("comm", "communications")
Workstation_data$Department[comm] <- "communication"

#Normalize computer science
Workstation_data$Department[Workstation_data$Department == "cs"] <- "computer science"

#Normalize earth science
Workstation_data$Department[Workstation_data$Department == "earth sci"] <- "earth sciences"

#Normalize economics
Workstation_data$Department[Workstation_data$Department == "econ"] <- "economics"

#Normalize engineering
engineering <- Workstation_data$Department %in% c("mrl", "ece", "electrical engineering")
Workstation_data$Department[engineering] <- "engineering"

#Normalize exercise & sport
Workstation_data$Department[Workstation_data$Department == "ess"] <- "exercise & sport"

#Normalize film & media
filmmedia <- Workstation_data$Department %in% c("film and media studies", "famst")
Workstation_data$Department[filmmedia] <- "film & media"

#Normalize geography
geog <- Workstation_data$Department %in% c("geo", "geog")
Workstation_data$Department[geog] <- "geography"

#Normalize global
Workstation_data$Department[Workstation_data$Department == "global studies"] <- "global"

#Normalize physics
Workstation_data$Department[Workstation_data$Department == "phys"] <- "physics"

#Normalize religious
Workstation_data$Department[Workstation_data$Department == "religious"] <- "religious studies"

#Normalize pstat/statistics/actuarial
pstat <- Workstation_data$Department %in% c("stats", "pstat", "statistics", "pstat / stats / actuarial", "actuarial science"  )
Workstation_data$Department[pstat] <- "pstat/stats/actuarial"

#Normalize tmp
tmp <- Workstation_data$Department %in% c("mtm", "tmp")
Workstation_data$Department[tmp] <- "technology management"

#Normalize n/a
nas <- Workstation_data$Department %in% c("option 35", "other \\(add to shift log\\)", "n/a", "*")
Workstation_data$Department[nas] <- "NA"

#Normalize poli sci
poli <- Workstation_data$Department %in% c("polisci", "poli sci")
Workstation_data$Department[poli] <- "political science"

#Normalize psychology
Workstation_data$Department[Workstation_data$Department == "psych"] <- "psychology"

#check if worked
#which(Workstation_data$Department == "eemb", arr.ind = TRUE)
#unique(Workstation_data$Department)

```
##Bundling depts (not already bundled)
```{r bundle depts, echo=FALSE}

# English, Comp Lit & Writing bundle
engcompwri <- Workstation_data$Department %in% c("english", "comp lit", "writing")
Workstation_data$Department[engcompwri] <- "english/comp lit/writing"

# Chicano, Black, Feminist
ethnicgender <- Workstation_data$Department %in% c("chicano studies", "feminist studies", "black studies")
Workstation_data$Department[ethnicgender] <- "chican@/black/feminist"


# Philosophy & Religious Studies & History
philrelihist <- Workstation_data$Department %in% c("philosophy", "religious studies", "history")
Workstation_data$Department[philrelihist] <- "philosophy/religion/history"


#Anthropology & Sociology
anthsoc <- Workstation_data$Department %in% c("anthropology", "sociology")
Workstation_data$Department[anthsoc] <- "anthropology/sociology"

#check
#unique(Workstation_data$Department)
```

```{r dept vis}
num_dept <- length(unique(Workstation_data$Department))
# create more colors per: https://www.datanovia.com/en/blog/easy-way-to-expand-color-palettes-in-r/
mycolors <- colorRampPalette(brewer.pal(8, "Set2"))(num_dept)
ggplot(Workstation_data) + 
  stat_count(aes(x = Department, fill = Department)) +
  scale_fill_manual(values = mycolors) + coord_polar() + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())

# top 10



#another try
depts <- unique(Workstation_data$Department)
#make department into Factor
Workstation_data$Department <- as.factor(Workstation_data$Department)

Workstation_data %>% 
  arrange(desc(Department)) 

#%>%
  slice(1:10) %>%
  ggplot() + stat_count(aes(x = Department, fill = Department)) +
  scale_fill_manual(values = 10) + coord_polar() + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
  


#one try
counted_Dept <- Workstation_data %>%
  count(Department)

head(sort(counted_Dept$n), 10)

toptendepts <- tail(sort(counted_Dept$n), 10)

ggplot(counted_Dept) + 
  aes(x = Department, y = n, fill = Department) +
  scale_fill_manual(values = mycolors) + coord_polar() + 
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
  
# bottom 10

#FIXME figure out scale - top 10 vs. lowest 10
```